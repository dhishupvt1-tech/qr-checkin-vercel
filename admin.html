<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard</title>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>

<body>

<h2>Admin â€“ Attendees</h2>

<ul id="list"></ul>

<script>
  const supabaseClient = supabase.createClient(
    "https://qwumwbmystwwhsjpllqn.supabase.co",
    "YOUR_ANON_KEY"
  );

  // ğŸ”’ LOCK PAGE + REMEMBER REDIRECT
  supabaseClient.auth.getUser().then(({ data }) => {
    if (!data.user) {
      localStorage.setItem("redirectAfterLogin", "admin.html");
      window.location.href = "login.html";
    }
  });

  async function loadAttendees() {
    const { data, error } = await supabaseClient
      .from("attendees")
      .select("*")
      .order("id", { ascending: false });

    if (error) {
      console.error(error);
      return;
    }

    const list = document.getElementById("list");
    list.innerHTML = "";

    data.forEach(a => {
      const li = document.createElement("li");
      li.innerHTML = `
        <b>${a.name}</b><br>
        Email: ${a.email}<br>
        Created by: ${a.created_by}<br>
        Status: ${a.checked_in ? "âœ”ï¸ Checked In" : "âŒ Not Checked In"}
        <hr>
      `;
      list.appendChild(li);
    });
  }

  loadAttendees();
</script>

</body>
</html>
