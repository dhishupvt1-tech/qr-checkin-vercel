<!DOCTYPE html>
<html>
<head>
  <title>Scan QR</title>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>

  <style>
    body { font-family: Arial; }
    pre { background:#f4f4f4; padding:10px; }
    .error { color:red; }
    .success { color:green; }
  </style>
</head>

<body>

<h2>Scan QR</h2>

<div id="reader" style="width:300px"></div>

<h3>Scanned Value</h3>
<pre id="scanned">Waiting…</pre>

<h3>Result</h3>
<div id="result"></div>

<script>
const supabaseClient = supabase.createClient(
  "https://qwumwbmystwwhsjpllqn.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF3dW13Ym15c3R3d2hzanBsbHFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0OTg0OTUsImV4cCI6MjA4NjA3NDQ5NX0.Pd9xovSIz0GwsZXBj1w79fe9HfsRCv1ZtWbkJ-Umh8M"
);

let locked = false;

async function onScanSuccess(text) {
  if (locked) return;
  locked = true;

  const scanned = text.trim();
  document.getElementById("scanned").innerText = scanned;

  const { data, error } = await supabaseClient
    .from("attendees")
    .select("*")
    .eq("qr", scanned);

  if (error) {
    document.getElementById("result").innerHTML =
      `<p class="error">${error.message}</p>`;
  } else if (!data || data.length === 0) {
    document.getElementById("result").innerHTML =
      `<p class="error">❌ QR NOT FOUND</p>`;
  } else {
    const a = data[0];
    document.getElementById("result").innerHTML = `
      <p class="success">✅ FOUND</p>
      Name: ${a.name}<br>
      Email: ${a.email}
    `;
  }

  setTimeout(() => locked = false, 2000);
}

new Html5Qrcode("reader").start(
  { facingMode: "environment" },
  { fps: 10, qrbox: 250 },
  onScanSuccess
);
</script>

</body>
</html>
